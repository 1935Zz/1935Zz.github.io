---
title: 数据密集型应用系统设计-第八章-分布式系统挑战
date: 2025-09-28 20:39:32
categories:
   - [Read-Note, 数据密集型应用系统设计]
---

对于⼀个应⽤系统，如果“数据”是其成败决定性因素，包括数据的规模、数据的复杂度或者数据产⽣与变化的速率等，我们就可以称为“数据密集型应⽤系统”，与之对应的是计算密集型（Compute-Intensive），CPU 主频往往是后者最⼤的制约瓶颈

# 数据系统基础

## 八、分布式系统挑战

![](https://cdn.jsdelivr.net/gh/1935Zz/1935zz.github.io@main/source/img/data-intensive/diagram-3.png)

与单节点系统差异显著，会出现各种问题

核心：构建可靠系统

认清分布式系统状态本质->评估所发生的各种故障

### 故障与部分失效

单节点运行具有确定性，当硬件正常时，主要问题是 bug，且相同的操作通常会产生相同的结果

分布式系统会出现部分失效，即一部分工作正常，一部分出现故障，难点在于部分失效的不确定：如有时网络正常，有时失败

#### 云计算和超算

构建大规模计算系统思路

1. 高性能计算，包含成千上万个 CPU 的超级计算机构成一个庞大的集群，通常用于计算密集型科学计算

2. 云计算

不同构建方式处理错误方法也不同。高性能计算通常会对任务保存快照，出现故障停止整个集群，修复后从最近快照执行（更像是一个单节点系统）

本书重点是基于互联网的服务，与 HPC 不同

1. 大部分是在线服务

2. HPC 通常采用专用的硬件，每个节点可靠性高，节点间主要通过共享内存或远程内存直接访问等技术通信。云计算节点多由通用机器构建，单节点成本低廉

3. 大型数据中心通常基于 IP 和以太网，HPC 通常基于特定的网络拓扑结构

4. 可容忍失败节点，让整体继续工作

5. 数据中心分布全球部署（让用户访问地理靠近的数据中心，降低延迟），HPC 通常假设节点位置靠近

必然面临部分失效，依靠软件系统提供容错机制，即在不可靠的组件上构建可靠的系统

### 不可靠的网络

主要关注分布式无共享系统：通过网络连接的多个节点，网络是跨节点通信唯一路径

互联网大多数据中心内部网络基于异步网络，节点通过网络发送消息到另一个节点，但网络不保证什么时候到达及是否到达。发送到等待响应过程中，可能出错的事情

1. 请求已丢失

2. 请求在某个队列中等待，无法马上发送

3. 远程接收节点已失效（如崩溃或关机）

4. 远程接收节点暂时无法响应

5. 远程接收节点已经完成请求处理，但回复在网络中丢失

6. 远程接收节点已经完成请求处理，回复被延迟处理

![](https://cdn.jsdelivr.net/gh/1935Zz/1935zz.github.io@main/source/img/data-intensive/screen2025-06-25 15.51.37.png)

#### 检测故障

需要自动检测节点失效

#### 超时和无限的延迟

延迟理论无限大，大多数系统无法保障数据包传输的延迟和处理数据包的时间

超时时间不好设置

**网络拥塞和排队**

延迟变化根源往往在于排队

1. 网络交换机处理大量数据包时的排队

2. 目标机器 cpu 均繁忙时，会被操作系统处理排队

3. 虚拟化环境 cpu 切换虚拟机导致的排队

4. tcp 流量控制的排队，以及 tcp 重传引入的延迟

### 不可靠的时钟

许多场景依赖时钟，包括判断请求超时，服务 p99，用户浏览时间，文章发表时间，缓存过期时间……

NTP（Network Time Protocol）网络时间协议：可以根据一组专门的时间服务器调整本地时间


