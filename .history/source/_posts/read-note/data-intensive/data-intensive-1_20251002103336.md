---
title: 数据密集型应用系统设计-第一章-可靠、可扩展与可维护的应用系统
date: 2025-09-28 20:39:32
categories:
   - [Read-Note, 数据密集型应用系统设计]
---

对于⼀个应⽤系统，如果“数据”是其成败决定性因素，包括数据的规模、数据的复杂度或者数据产⽣与变化的速率等，我们就可以称为“数据密集型应⽤系统”，与之对应的是计算密集型（Compute-Intensive），CPU 主频往往是后者最⼤的制约瓶颈

# 数据系统基础

## 一、可靠、可扩展与可维护的应用系统

**可靠性：当出现意外情况如硬件、软件故障、人为失误等，系统应可以继续正常运转：虽然性能可能有所降低，但确保功能正确。**

如何保障可靠性

* 最小出错方式设计系统，如精心设计的抽象层、API 以及管理界面

* 分离易出错地方、容易引发故障的接口，如提供一个功能齐全但非生产用的沙箱环境，使人们可以放心的尝试、体验，包括导入真实的数据，万一出现问题，不会影响真实用户

* 充分测试

* 快速恢复机制，滚动发布，数据校验

* 清晰监控



**可扩展性：随着规模的增长，例如数据量、流量或复杂性，系统应以合理的方式来匹配这种增长。描述系统应对负载增加能力**

描述负载：如 qps，数据库写入比例，聊天室的同时话动用户数量，缓存命中率等，平均值或峰值

Twitter 的例子，每个用户关注者的分布情况（还可以结合用户使用 Twitter 频率情况进行加权）是该案例可扩展的关键负载参数

两个业务场景：发布 tweet 消息，用户可以快速推送新消息到所有的关注者；主页时间线浏览，查看关注对象的最新消息

两个方案

![](image-10.png)

![](image-9.png)

描述性能：离线-吞吐量，在线-响应时间，sli，slo，sla，avg，p50，p99......

应对负载增加：垂直扩展，水平扩展，分布式系统



**可维护性：随着时间的推移，许多新的人员参与到系统开发和运维，以维护现有功能或适配新场景等，系统都应高效运转**

1. 可运维性：方便运营团队来保持系统平稳运行。良好的可操作性意味着对系统健康状况有良好的可观测性和有效的管理方法

2. 简单性：简化系统复杂性，使新工程师能够轻松理解系统

**复杂性的表现方式：**&#x72B6;态空间的膨胀，模块紧耦合，令人纠结的相互依赖关系，不一致的命名和术语，为了性能而采取的特殊处理，另解决某特定问题而引人的特殊框架

**消除复杂性的手段之一：抽象。**&#x4E00;个好的设计抽象可以隐藏大量的实现细节，并对外提供干净、易懂的接口。一个好的设计抽象可用于各种不同的应用程序。这样，复用远比多次重复实现更有效率；另一方面，也带来更高质量的软件，而质量过硬的抽象组件所带来的好处，可以使运行其上的所有应用轻松获益

* 可演化性：后续工程师能够轻松地对系统进行改进，并根据需求变化将其适配到非典型场景，也称为可延伸性、易修改性或可塑性



## 二、数据模型与查询语言

数据的表示，由上而下

1. 现实世界建模，通过对象、数据结构、api

2. 通用数据模型（例如 JSON 或 XML 文档、关系数据库中的表或图模型）

3. 内存、磁盘、网络的字节格式（数据库工程师）

4. 电流，光脉冲（硬件工程师）

**关系模型和文档模型**

IMS（用于 IBM），层次模型，树状，类似文档数据库的 json 模型，很好支持一对多，较难支持多对多

出现关系模型（后来的 sql）和网络模型

网络模型：由 ConferenceonDataSystemLanguages（CODASYL）标准化，层次模型的推广，每个记录有多个父节点，由于相同记录有多条不同路径，需要手动选择路径，并且数据模型更改困难，需要大量手写代码

**关系模型**：定义所有数据格式，关系即元组的集合，没有复杂的嵌套结构，也没有复杂的访问路径，“访问路径“由查询优化器自动生成

之后出现 NoSQL，包括文档数据库和图数据库

**文档模型**：某种方式层次模型，目标用例是数据来自于自包含文档，且一个文档与其他文档之间的关联很少

对于多对一和多对多，关系模型和文档模型都由唯一标识符引用（外键，文档引用）

**数据查询语言**

命令型明确指出执行步骤

声明型指定数据模式和条件，隐藏了底层实现步骤和引擎实现细节，在数据库中好于命令式

MapReduce，两者都不是，底层的编程模型，计算集群分布执行

**图状数据模型**

针对相反的场景，目标用例是所有数据都可能会互相关联

属性图：顶点，边，可以看做两个关系表，一个顶点表，一个边表

cypher 查询语言，声明式

![](image-7.png)

三元存储

（主体，key，value），（主体，边 label，客体）

SPARQL：RDF 数据模型的三元存储查询语言

![](image-6.png)



> 图模型和网络模型比较
>
> 1. 网络模型指定了嵌套关系，限制了嵌套，图模型没有限制，任意顶点都可以连向其它顶点
>
> 2. 网络模型获取特定记录只能遍历其中一条访问路径，图模型可以通过顶点唯一 id 获取顶点，也可以索引查找某个顶点
>
> 3. 网络模型记录的自己录是有序集合，图模型顶点和边无序
>
> 4. 网络模型所有查询都是命令式，难以编写，易被模式变更破坏，图模型可以用命令式代码，也可以用声明式语言，如 Cypher 和 SPARQL

Datalog：谓语（主体，客体）的表达方式

![](image-11.png)

定义新谓语的规则，从数据或其他规则派生而来，每次完成一小块，派生出复杂的查询

